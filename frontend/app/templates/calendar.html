{% extends 'base.html' %}

{% block title %} Calendar {% endblock %}


{% block content %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js'></script>

<div class="container mt-5">
    <h1>Hello, Internal Page!</h1>
    <p>This is an internal page for interacting with a FastAPI backend.</p>

    <form method="POST" action="">
        {{ form.csrf_token }}
        <div class="form-group">
            {{ form.location.label }}
            {% for checkbox in form.location %}
            <div class="form-check">
                {{ checkbox }} {{ checkbox.label }}
            </div>
            {% endfor %}
        </div>
        <div class="form-group">
            {{ form.degreetype.label }}
            {% for checkbox in form.degreetype %}
            <div class="form-check">
                {{ checkbox }} {{ checkbox.label }}
            </div>
            {% endfor %}
        </div>
        <div class="form-group">
            {{ form.teaching.label }}
            {{ form.teaching(class="form-control", placeholder="Enter teaching") }}
        </div>
        {{ form.submit(class="btn btn-primary") }}
    </form>

    <!-- Calendar container -->
    <div id='calendar' class='mt-3'></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        alert("JavaScript is loaded!");
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            eventClick: function(info) {
                info.jsEvent.preventDefault(); // Don't let the browser navigate
                if (info.event.url) {
                    window.open(info.event.url, '_blank');
                }
            }
    });
    calendar.render();

    // Attach an event handler for form submission
    document.getElementById('query-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent actual form submission
        var teaching = document.querySelector("[name='teaching']").value;
        var location_str = Array.from(document.querySelectorAll("[name='location']:checked")).map(el => el.value).join(","); // ora Ã¨ drop
        var degreetype_str = Array.from(document.querySelectorAll("[name='degreetype']:checked")).map(el => el.value).join(",");
        // var credits = 
        
        var url = `/query/${teaching}/${location_str}/${degreetype_str}`; // update questa
        fetch(url)
            .then(response => response.json())
            .then(result => {
                calendar.removeAllEvents(); // Clear existing events
                calendar.addEventSource(result); // Add new data
            })
            .catch(error => console.error('Error loading the calendar data:', error));
         });
    });
    </script>
{% endblock %}
